# 要件定義書

## プロジェクト概要

YouTubeで学んだ英語フレーズを管理・復習するためのWebアプリケーション。
音声再生機能により、効率的な学習をサポートする。

---

## 機能要求

### 1. ユーザー認証機能

#### 1.1 新規アカウント作成
- **要求**: ユーザー名とパスワードで新規アカウントを作成できる
- **制約**: 
  - ユーザー名は一意である必要がある
  - パスワードは4文字以上
  - パスワードはハッシュ化して保存（SHA-256）
- **UI**: タブ形式で「ログイン」と「新規登録」を切り替え

#### 1.2 ログイン機能
- **要求**: ユーザー名とパスワードで認証できる
- **動作**: 認証成功後、セッション状態を保持
- **エラー処理**: 認証失敗時は適切なエラーメッセージを表示

#### 1.3 ログアウト機能
- **要求**: サイドバーからログアウトできる
- **動作**: セッション情報をクリアしてログイン画面に戻る

---

### 2. フレーズ管理機能

#### 2.1 フレーズ追加
- **要求**: 以下の情報を入力してフレーズを登録できる
  - 英語フレーズ（必須）
  - 日本語の意味（任意）
  - YouTube URL（任意）
  - タイムスタンプ（秒単位、任意）
- **UI**: フォーム形式で入力
- **フィードバック**: 追加成功時にメッセージを表示

#### 2.2 フレーズ一覧表示
- **要求**: 登録済みフレーズを一覧表示できる
- **表示内容**: ID、フレーズ、意味、URL、タイムスタンプ、学習状態、作成日時
- **ソート**: 作成日時の降順

#### 2.3 CSV一括インポート
- **要求**: CSVファイルからフレーズを一括登録できる
- **必須カラム**: 
  - 英語フレーズ（`phrase`）
  - 日本語の意味（`meaning`）
- **機能**: 
  - カラムマッピング機能（ユーザーが列を選択）
  - プレビュー表示
  - インポート前に既存データを削除するオプション
- **エラー処理**: カラム不足時はエラーメッセージを表示

---

### 3. 学習管理機能

#### 3.1 レビューモード
- **要求**: 未学習のフレーズのみを表示
- **表示形式**: カード形式で1件ずつ表示
- **機能**: 
  - フレーズと意味を表示
  - YouTube URLがある場合はリンクを表示
  - タイムスタンプ付きURLに対応
  - 「学習済み」ボタンで学習状態を更新
- **フィードバック**: 学習済みマーク時にバルーンアニメーション

#### 3.2 学習進捗管理
- **要求**: フレーズごとに学習状態（未学習/学習済み）を管理
- **初期状態**: 新規追加時は「未学習」
- **更新**: レビューモードで「学習済み」ボタンをクリック

---

### 4. ラジオモード（音声再生機能）

#### 4.1 音声生成
- **要求**: 未学習フレーズの音声を自動生成
- **フォーマット**: 
  - 英語フレーズ × 2回
  - 日本語の意味 × 1回
  - この順序で連続再生
- **音声エンジン**: Google Text-to-Speech (gTTS)
- **言語**: 
  - 英語: `lang='en'`
  - 日本語: `lang='ja'`

#### 4.2 再生件数制限
- **要求**: スライダーで再生するフレーズ数を選択できる
- **デフォルト**: 10件
- **最大**: 登録されている未学習フレーズ数まで
- **理由**: メモリ使用量の制限

#### 4.3 プログレス表示
- **要求**: 音声生成中の進捗をリアルタイム表示
- **表示内容**: 
  - プログレスバー
  - 現在生成中のフレーズ名
  - 進捗（X件/全Y件）

#### 4.4 音声プレイヤー
- **要求**: 生成した音声を再生できる
- **実装方式**: HTMLの`<audio>`タグ + Base64エンコーディング
- **対応ブラウザ**: 
  - PC: Chrome, Firefox, Safari, Edge
  - モバイル: iOS Safari, Android Chrome
- **UI**: 標準のHTML5プレイヤー（再生/一時停止/シーク）

---

### 5. データ管理機能

#### 5.1 学習進捗リセット
- **要求**: 全フレーズを「未学習」状態に戻す
- **動作**: データは削除せず、学習状態のみリセット

#### 5.2 全データ削除
- **要求**: 全フレーズを削除できる
- **安全対策**: チェックボックスで確認を求める
- **警告**: 「この操作は取り消せません」と明記

#### 5.3 学習済みフレーズ削除
- **要求**: 学習済みのフレーズのみを一括削除
- **用途**: 学習完了後のデータ整理

---

## 非機能要求

### 1. パフォーマンス

#### 1.1 音声生成速度
- **要求**: 10件のフレーズを30秒以内に生成
- **制約**: gTTSのAPI速度に依存

#### 1.2 メモリ使用量
- **要求**: Streamlit Cloud無料プランの制限内（約1GB）
- **対策**: ラジオモードの再生件数を制限

#### 1.3 ページ読み込み速度
- **要求**: 初回ロード時間3秒以内
- **対策**: データベースクエリの最適化

---

### 2. セキュリティ

#### 2.1 パスワード保護
- **要求**: パスワードは平文で保存しない
- **実装**: SHA-256ハッシュ化
- **将来の改善**: bcryptやargon2への移行を推奨

#### 2.2 データ分離
- **要求**: ユーザーごとにデータを完全分離
- **実装**: 全てのクエリで`user_id`によるフィルタリング
- **検証**: 他のユーザーのデータは一切閲覧・編集不可

#### 2.3 SQLインジェクション対策
- **要求**: パラメータ化クエリを使用
- **実装**: SQLiteのプレースホルダー（`?`）を使用

---

### 3. 可用性

#### 3.1 デプロイ環境
- **プラットフォーム**: Streamlit Community Cloud
- **プラン**: 無料プラン
- **自動デプロイ**: GitHubへのプッシュで自動再デプロイ

#### 3.2 データ永続化
- **データベース**: SQLite
- **ファイル名**: `phrases.db`
- **バックアップ**: 手動（将来的にエクスポート機能を追加予定）

#### 3.3 エラーハンドリング
- **要求**: 全ての主要機能でtry-exceptを実装
- **ユーザーフィードバック**: エラー発生時は`st.error()`で表示
- **ログ**: Streamlit Cloudのログに記録

---

### 4. ユーザビリティ

#### 4.1 レスポンシブデザイン
- **要求**: PC・スマートフォンの両方で使用可能
- **対応デバイス**: 
  - PC: デスクトップブラウザ
  - モバイル: iPhone (iOS Safari), Android
- **レイアウト**: Streamlitのデフォルトレスポンシブ対応

#### 4.2 日本語対応
- **要求**: 全てのUI要素を日本語で表示
- **例外**: コード内のコメント・変数名は英語

#### 4.3 直感的なUI
- **メニュー**: サイドバーで機能を選択
- **フィードバック**: 
  - 成功時: `st.success()`
  - エラー時: `st.error()`
  - 情報: `st.info()`
  - 警告: `st.warning()`

---

### 5. 互換性

#### 5.1 ブラウザ対応
- **必須対応**: 
  - Chrome (最新版)
  - Safari (iOS含む)
  - Firefox (最新版)
  - Edge (最新版)
- **音声再生**: HTML5 audioタグ対応ブラウザ

#### 5.2 Python環境
- **バージョン**: Python 3.9以上
- **依存関係**: 
  - `streamlit==1.50.0`
  - `pandas==2.3.3`
  - `gtts==2.5.4`

---

### 6. 保守性

#### 6.1 コード構造
- **分離**: 
  - `app.py`: UI・ビジネスロジック
  - `database.py`: データベース操作
- **コメント**: 主要機能にセルマーカー（`#%%`）を追加

#### 6.2 バージョン管理
- **リポジトリ**: GitHub
- **ブランチ戦略**: mainブランチのみ（個人開発）
- **コミットメッセージ**: 英語で簡潔に記述

#### 6.3 ドキュメント
- **README.md**: プロジェクト概要・使い方
- **requirements.txt**: 依存パッケージ
- **.gitignore**: 不要ファイルの除外設定

---

## 制約条件

### 1. 技術的制約
- Streamlit Community Cloud無料プランの制限
  - メモリ: 約1GB
  - CPU: 共有リソース
  - ストレージ: 制限あり
- SQLiteの同時書き込み制限（1つずつ）

### 2. 外部サービス依存
- **gTTS (Google Text-to-Speech)**
  - インターネット接続必須
  - APIレート制限の可能性
  - 音声品質はGoogleのサービスに依存

### 3. ユーザー数の想定
- **想定**: 個人〜小規模グループ（〜100ユーザー）
- **スケール時の対応**: PostgreSQLへの移行を検討

---

## 将来の拡張案

### 優先度: 高
1. **パスワードリセット機能**
2. **CSVエクスポート機能**
3. **フレーズ検索機能**

### 優先度: 中
1. **復習スケジュール（間隔反復学習）**
2. **学習統計の表示**
3. **音声の無音区間追加（聞きやすさ向上）**

### 優先度: 低
1. **ダークモード対応**
2. **プロフィール編集機能**
3. **メール認証**

---

## 変更履歴

| 日付 | バージョン | 変更内容 |
|------|-----------|---------|
| 2026-02-14 | 1.0 | 初版作成 |

---

## 承認

- **作成者**: AI Assistant
- **レビュー**: ユーザー
- **承認日**: 2026-02-14
